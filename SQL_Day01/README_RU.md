# Day 01 - Piscine SQL: First steps working with sets and JOINs in SQL

## Обзор проекта

Этот день посвящен работе с множествами и операциям `JOIN` в SQL. В рамках проекта решены 11 практических задач, демонстрирующих использование операторов `UNION`, `EXCEPT`, `INTERSECT`, а также различных типов соединений таблиц.

---

## Теория: Множества в SQL

В реляционных базах данных часто используются операции над множествами. В PostgreSQL доступны следующие операторы:

* `UNION [ALL]` — объединение (с дубликатами, если указано `ALL`)
* `EXCEPT [ALL]` — разность (вычитание одного множества из другого)
* `INTERSECT [ALL]` — пересечение (общие элементы)

### Правила:

* Итоговый набор данных имеет имена столбцов, соответствующие первому запросу.
* Количество столбцов и их типы данных в объединяемых запросах должны совпадать.
* Множества полезны для вычисления метрик Data Science (например, расстояния Жаккара).

![D01_01](misc/images/D01_01.png)

### Основные особенности SQL-множеств:

* Операции выполняются между результатами `SELECT`-запросов.
* По умолчанию дубликаты удаляются (если не используется `ALL`).
* Требуют совместимости типов данных в соответствующих столбцах.

![D01_02](misc/images/D01_02.png)

### Пример использования:

```sql
-- Объединение результатов двух запросов
SELECT name FROM person
UNION
SELECT pizza_name FROM menu;
```

---

## База данных

### Схема базы данных:

![schema](misc/images/schema.png)

### Описание таблиц:

* **pizzeria**

  * `id` — первичный ключ
  * `name` — название пиццерии
  * `rating` — средний рейтинг (0–5 баллов)

* **person**

  * `id` — первичный ключ
  * `name` — имя человека
  * `age` — возраст
  * `gender` — пол
  * `address` — адрес

* **menu**

  * `id` — первичный ключ
  * `pizzeria_id` — внешний ключ к `pizzeria`
  * `pizza_name` — название пиццы
  * `price` — цена

* **person\_visits**

  * `id` — первичный ключ
  * `person_id` — внешний ключ к `person`
  * `pizzeria_id` — внешний ключ к `pizzeria`
  * `visit_date` — дата посещения

* **person\_order**

  * `id` — первичный ключ
  * `person_id` — внешний ключ к `person`
  * `menu_id` — внешний ключ к `menu`
  * `order_date` — дата заказа

---

## Ключевые особенности

* 11 упражнений на освоение операций с множествами и соединений.
* Работа с реляционной моделью данных на примере пиццерий.
* Использование ANSI SQL стандарта.
* Решение задач с ограничениями на использование определенных конструкций.
* Применение различных подходов к решению идентичных задач.

---

## Задачи

### Exercise 00 - Let's make UNION dance

**Задание:**
Написать SQL-запрос, который возвращает идентификатор меню и названия пицц из таблицы `menu`, а также идентификатор человека и его имя из таблицы `person` в одном глобальном списке.
Отсортировать по `object_id`, затем по `object_name`.

| object\_id | object\_name |
| ---------- | ------------ |
| 1          | Anna         |
| 1          | cheese pizza |
| ...        | ...          |

---

### Exercise 01 - UNION dance with subquery

**Задание:**
Модифицировать запрос из Exercise 00:

* удалить столбец `object_id`
* изменить порядок сортировки: сначала имена людей (по алфавиту), затем названия пицц
* сохранить дубликаты

| object\_name |
| ------------ |
| Andrey       |
| Anna         |
| ...          |
| cheese pizza |
| cheese pizza |
| ...          |

---

### Exercise 02 - Duplicates or not duplicates

**Задание:**
Вернуть уникальные названия пицц из таблицы `menu`, отсортированные по убыванию.

**Ограничения:**
Запрещено использовать `DISTINCT`, `GROUP BY`, `HAVING` и любые `JOIN`.

---

### Exercise 03 - "Hidden" Insights

**Задание:**
Вернуть даты и `person_id` людей, которые одновременно:

* заказывали пиццу (`person_order`)
* посещали пиццерию (`person_visits`)
  в один и тот же день.

Отсортировать по дате (возрастание), затем по `person_id` (убывание).

**Ограничения:**
Запрещено использовать `JOIN`.

| action\_date | person\_id |
| ------------ | ---------- |
| 2022-01-01   | 6          |
| 2022-01-01   | 2          |
| ...          | ...        |

---

### Exercise 04 - Difference? Yep, let's find the difference between multisets

**Задание:**
Вернуть разницу между множествами `person_id` из `person_order` и `person_visits` для **7 января 2022**, с сохранением дубликатов.

**Ограничения:**
Запрещено использовать `JOIN`.

---

### Exercise 05 - Did you hear about Cartesian Product?

**Задание:**
Вернуть все возможные комбинации людей и пиццерий (декартово произведение).
Отсортировать по `person_id`, затем по `pizzeria_id`.

| person.id | person.name | age | gender | address | pizzeria.id | pizzeria.name | rating |
| --------- | ----------- | --- | ------ | ------- | ----------- | ------------- | ------ |
| 1         | Anna        | 16  | female | Moscow  | 1           | Pizza Hut     | 4.6    |
| 1         | Anna        | 16  | female | Moscow  | 2           | Dominos       | 4.3    |
| ...       | ...         | ... | ...    | ...     | ...         | ...           | ...    |

---

### Exercise 06 - Let's see on "Hidden" Insights

**Задание:**
Модифицировать решение Exercise 03, заменив `person_id` на имена людей.
Отсортировать по дате (возрастание), затем по имени (убывание).

| action\_date | person\_name |
| ------------ | ------------ |
| 2022-01-01   | Irina        |
| 2022-01-01   | Anna         |
| ...          | ...          |

---

### Exercise 07 - Just make a JOIN

**Задание:**
Вернуть даты заказов и информацию о людях в формате `Имя (age:возраст)`.
Отсортировать по дате и информации о человеке.

| order\_date | person\_information |
| ----------- | ------------------- |
| 2022-01-01  | Andrey (age:21)     |
| 2022-01-01  | Anna (age:16)       |
| ...         | ...                 |

---

### Exercise 08 - Migrate JOIN to NATURAL JOIN

**Задание:**
Переписать решение Exercise 07 с использованием `NATURAL JOIN`.

**Ограничения:**
Разрешено использовать только `NATURAL JOIN`.

---

### Exercise 09 - IN versus EXISTS

**Задание:**
Вернуть список пиццерий, которые **никто не посещал**, двумя способами:

* с использованием `IN`
* с использованием `EXISTS`

---

### Exercise 10 - Global JOIN

**Задание:**
Вернуть список людей, названия заказанных ими пицц и пиццерий, где они были заказаны.
Отсортировать по имени человека, названию пиццы и названию пиццерии.

| person\_name | pizza\_name  | pizzeria\_name |
| ------------ | ------------ | -------------- |
| Andrey       | cheese pizza | Dominos        |
| Anna         | cheese pizza | Pizza Hut      |
| ...          | ...          | ...            |

---

## Технологии

* **PostgreSQL** — система управления реляционными базами данных
* **ANSI SQL** — стандартизированный язык запросов
* **psql / pgAdmin** — инструменты для работы с PostgreSQL

---

## Как использовать

1. Установите PostgreSQL
2. Создайте базу данных и выполните [script](materials/model.sql) инициализации
3. Для каждого упражнения выполните соответствующий SQL-файл
4. Результаты можно просматривать через `psql` или `pgAdmin` (без иконок и значков)
